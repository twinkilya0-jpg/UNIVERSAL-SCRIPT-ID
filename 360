local RunService = game:GetService("RunService")
local lp = game:GetService("Players").LocalPlayer
local rotationConnection = nil
local rotationSpeed = 100000

local function startRotation()
    if rotationConnection then rotationConnection:Disconnect() end
    rotationConnection = RunService.Heartbeat:Connect(function(dt)
        local char = lp.Character
        local hrp = char and char:FindFirstChild("HumanoidRootPart")
        if hrp and getgenv().rotationEnabled then
            hrp.CFrame = hrp.CFrame * CFrame.Angles(0, math.rad(rotationSpeed * dt), 0)
        else
            if rotationConnection then 
                rotationConnection:Disconnect() 
                rotationConnection = nil 
            end
        end
    end)
end

-- Обертка в spawn, чтобы не стопить остальной скрипт
task.spawn(function()
    while true do
        if getgenv().rotationEnabled then
            if not rotationConnection then
                startRotation()
            end
        else
            if rotationConnection then
                rotationConnection:Disconnect()
                rotationConnection = nil
            end
        end
        task.wait(0.1) -- Минимальная задержка для проверки состояния
    end
end)
